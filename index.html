<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UIC Pályaszámok</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        .ddd input,
        .eee input {
            background-color: #001f7f; /* sötétkék háttér */
            color: #ffffff; /* fehér betűszín */
        }
        input[type="text"] {
            width: 40px;
            height: 40px;
            text-align: center;
            font-size: 18px;
        }
        @media (max-width: 768px) {
            .aa-bb, .c, .ddd, .eee, .f {
                gap: 0px; /* Térköz eltávolítása mobilnézetben */
            }
            input[type="text"] {
                width: 30px;
                height: 30px;
            }
            .button-group {
                display: flex;
                justify-content: space-between;
                flex-wrap: wrap;
                margin-top: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container mt-5">
        <h1 class="text-center mb-4">UIC Pályaszám</h1>
        <div class="d-flex justify-content-center gap-3 mb-4 flex-wrap">
            <div id="container" class="d-flex gap-3">
                <!-- AA BB C DDD EEE F -->
                <div class="aa-bb d-flex gap-2"></div>
                <div class="c d-flex gap-2"></div>
                <div class="ddd d-flex gap-2"></div>
                <div class="eee d-flex gap-2"></div>
                <div class="f d-flex gap-2"></div>
            </div>
            <div class="button-group d-flex gap-2">
                <button id="copyButton" class="btn btn-primary w-100">
                    <i class="fas fa-copy"></i>
                </button>
                <button id="clearButton" class="btn btn-danger w-100">
                    <i class="fas fa-trash"></i>
                </button>
            </div>
        </div>
        <div id="infoContainer" class="text-start"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const container = document.getElementById("container");
        const infoContainer = document.getElementById("infoContainer");
        const segments = [2, 2, 1, 3, 3, 1];
        const inputFields = [];
        let lastKeyWasBackspace = false;

        segments.forEach((length, index) => {
            const segmentContainer = document.createElement("div");
            segmentContainer.classList.add("d-flex", "gap-2");

            for (let i = 0; i < length; i++) {
                const input = document.createElement("input");
                input.type = "text";
                input.maxLength = 1;
                input.classList.add("form-control", "border", "text-center");
                input.inputMode = "numeric"; // Számbillentyűzet mobilon
                input.dataset.segment = index;
                input.dataset.indexInSegment = i;
                if (index === 3 || index === 4) { // DDD és EEE mezők
                    input.style.backgroundColor = "#001f7f"; // sötétkék háttér
                    input.style.color = "#ffffff"; // fehér betűszín
                }
                segmentContainer.appendChild(input);
                inputFields.push(input);
            }

            container.appendChild(segmentContainer);
        });

        // F mező frissítése minden billentyűleütéskor
        inputFields.forEach((input, index) => {
            input.addEventListener("input", (e) => {
                if (e.target.value.length === 2) {
                    inputFields[index].value = e.target.value[0];
                    if (index < inputFields.length - 1) {
                        inputFields[index + 1].value = e.target.value[1];
                        inputFields[index + 1].focus();
                    }
                }
                if (e.inputType === "deleteContentBackward" && index > 0) {
                    inputFields[index - 1].focus();
                } else if (e.target.value && index < inputFields.length - 1) {
                    inputFields[index + 1].focus();
                }
                updateChecksum();
                updateTrainInfo();
            });

            input.addEventListener("keydown", (e) => {
                if (e.key === "Backspace") {
                    if (!e.target.value && index > 0 && lastKeyWasBackspace) {
                        inputFields[index - 1].focus();
                        inputFields[index - 1].value = ''; 
                        e.preventDefault();
                    }
                    lastKeyWasBackspace = true;
                } else {
                    lastKeyWasBackspace = false;
                }
            });

            input.addEventListener("paste", (e) => {
                const pasteData = e.clipboardData.getData('text');
                if (/^\d{11,12}$/.test(pasteData)) {
                    e.preventDefault();
                    for (let i = 0; i < 11; i++) {
                        if (i < pasteData.length) {
                            inputFields[i].value = pasteData[i];
                        } else {
                            inputFields[i].value = '';
                        }
                    }
                    updateChecksum();
                    updateTrainInfo();
                }
            });
        });

        // Ellenőrző szám (F) frissítése - csak ha az első 11 mező ki van töltve
        function updateChecksum() {
            let allFilled = true;
            for (let i = 0; i < 11; i++) {
                if (inputFields[i].value === '') {
                    allFilled = false;
                    break;
                }
            }

            if (allFilled) {
                const weights = [2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2];
                let sum = 0;
                for (let i = 0; i < 11; i++) {
                    const value = parseInt(inputFields[i].value) || 0;
                    let product = value * weights[i];
                    if (product > 9) product -= 9;
                    sum += product;
                }
                const checksum = (10 - (sum % 10)) % 10;
                inputFields[11].value = checksum;
                inputFields[11].classList.add("fw-bold");
                inputFields[11].disabled = true;
            } else {
                inputFields[11].value = ''; // Üresen hagyja, ha nincs minden mező kitöltve
            }
        }

        document.getElementById("copyButton").addEventListener("click", () => {
            let fullNumber = "";
            inputFields.forEach(input => {
                fullNumber += input.value || "";
            });
            navigator.clipboard.writeText(fullNumber).then(() => {
                alert("Pályaszám vágólapra másolva: " + fullNumber);
            }).catch(err => {
                alert("Hiba történt a másolás során: " + err);
            });
        });

        document.getElementById("clearButton").addEventListener("click", () => {
            inputFields.forEach(input => {
                input.value = "";
            });
            inputFields[0].focus();
            infoContainer.innerHTML = "";
        });

        // A kurzor az első mezőbe kerül az oldal betöltésekor
        window.onload = () => {
            inputFields[0].focus();
        };

        function updateTrainInfo() {
            const firstDigit = parseInt(inputFields[0].value);
            const secondDigit = parseInt(inputFields[1].value);
            const fifthDigit = parseInt(inputFields[4].value);
            const countryCode = inputFields.slice(2, 4).map(input => input.value).join("");
            let infoText = "";

            if (!isNaN(firstDigit)) {
                if (firstDigit >= 0 && firstDigit <= 3) {
                    infoText += "1. számjegy: <b>Teherkocsi</b><br>";
                } else if (firstDigit === 4 || firstDigit === 5) {
                    infoText += "1. számjegy: <b>Személyszállító jármű</b><br>";
                } else if (firstDigit === 6) {
                    infoText += "1. számjegy: <b>Villamos motorvonat/mozdony</b><br>";
                } else if (firstDigit === 7) {
                    infoText += "1. számjegy: <b>Dízel motorvonat</b><br>";
                } else if (firstDigit >= 8 && firstDigit <= 9) {
                    infoText += "1. számjegy: <b>Vontatójármű</b><br>";
                }
            }

            if (!isNaN(secondDigit)) {
                const descriptions = [
                    "gőz-, hibridmozdony, városi vasutak és trolibusz",
                    "villamos mozdony (V ≥ 100 km/h)",
                    "dízel mozdony (V ≥ 100 km/h)",
                    "nagysebességű villamos motorkocsi/vonat (V ≥ 190 km/h)",
                    "villamos motorkocsi/vonat (V < 190 km/h)",
                    "dízel motorkocsi/vonat + első 30 Flirt + keskeny nyomközű dízelmozdony",
                    "különleges mellék-, vagy pótkocsi",
                    "villamos tolatómozdony (V < 100 km/h)",
                    "dízel tolatómozdony (V < 100 km/h)",
                    "speciális, építési és karbantartási járművek"
                ];
                if (secondDigit >= 0 && secondDigit <= 9) {
                    infoText += `2. számjegy: <b>${descriptions[secondDigit]}</b><br>`;
                }
            }

            const countryCodes = {
                "55": "Magyarország",
                "80": "Németország"
            };

            if (countryCodes[countryCode]) {
                infoText += `3-4. számjegy: <b>${countryCodes[countryCode]}</b><br>`;
            }

            if (!isNaN(fifthDigit)) {
                const fifthDescriptions = [
                    "egytagú egység",
                    "többtagú egység 1. (A) tagja",
                    "többtagú egység 2. (B) tagja",
                    "többtagú egység 3. tagja",
                    "többtagú egység 4. tagja",
                    "többtagú egység 5. tagja",
                    "többtagú egység 6. tagja",
                    "csatolt, 10-nél több tengelyű mozdony, a hatodik jegy a hajtott kerékpárok számát adja (n-10)",
                    "eltérő nyomtávú egység",
                    "speciális járművek"
                ];
                if (fifthDigit >= 0 && fifthDigit <= 9) {
                    infoText += `5. számjegy: <b>${fifthDescriptions[fifthDigit]}</b><br>`;
                }
            }

            const sixthDigit = parseInt(inputFields[5].value);
            if (!isNaN(sixthDigit)) {
                infoText += `6. számjegy: Hajtott kerékpárok száma: <b>${sixthDigit}</b><br>`;
            }

            const seventhDigit = parseInt(inputFields[6].value);
            if (!isNaN(seventhDigit)) {
                infoText += `7. számjegy: Azonos csoporton belüli típusszám: <b>${seventhDigit}</b><br>`;
            }

            const eighthDescriptions = [
                "villanymozdony-sorozaton belüli főváltozat",
                "villanymozdony-sorozaton belüli A változat",
                "villanymozdony-sorozaton belüli B változat",
                "villanymozdony-sorozaton belüli C változat",
                "villamos motorkocsi sorozat A",
                "villamos motorvonat sorozat B",
                "dízel motorvonat sorozat A",
                "dízel motorkocsi sorozat B",
                "dízelmozdony-sorozaton belüli változat A",
                "dízelmozdony-sorozaton belüli változat B"
            ];

            const eighthDigit = parseInt(inputFields[7].value);
            if (!isNaN(eighthDigit) && eighthDigit >= 0 && eighthDigit <= 9) {
                infoText += `8. számjegy: <b>${eighthDescriptions[eighthDigit]}</b><br>`;
            }

            const serialNumber = inputFields.slice(8, 11).map(input => input.value).join("");
            if (serialNumber.length === 3) {
                infoText += `9-11. számjegy: Jármű egyedi sorszáma: <b>${serialNumber}</b><br>`;
            }

            const checksum = inputFields[11].value;
            if (checksum) {
                infoText += `12. számjegy: Ellenőrző szám: <b>${checksum}</b><br>`;
            }

            infoContainer.innerHTML = infoText;
        }
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/js/all.min.js"></script>
</body>
</html>
